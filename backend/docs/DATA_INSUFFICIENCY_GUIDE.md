# Руководство по обработке недостаточности данных

## Принцип работы системы

Система **eMedosmotr AI** работает **СТРОГО на основе Приказа МО РК №722** и его Приложения 2.

### ⚠️ Критически важный принцип:

**ЗАПРЕЩЕНО использовать параметры, которых НЕТ в Приказе №722!**

Если в заключении врача указан диагноз, но недостаточно конкретных параметров для точной классификации по Приказу - система **ОБЯЗАНА** сообщить об этом.

## Примеры недостаточности данных

### 1. Грыжа межпозвоночного диска

#### ❌ Недостаточно данных:

**Заключение врача:**
```
Грыжа межпозвоночного диска L5-S1 размером 7 мм с секвестрацией
```

**Что есть в Приказе №722 для статьи 66:**
- "Критический стеноз спинномозгового канала (шейный <13мм, грудной <13мм, поясничный <16мм) с грубыми проводниковыми или корешковыми расстройствами" → подпункт 1 (Д-Д-Д-НГ)
- "Приобретенный стеноз спинномозгового канала с клиническими проявлениями (боли, неврологические расстройства)" → подпункт 2 (Д-Д-В-НГ)
- "Остеохондроз с глубокими пара- и тетрапарезами с нарушением функции сфинктеров" → подпункт 1 (Д-Д-Д-НГ)
- "Последствия дискэктомии с прогрессированием неврологического дефицита" → подпункт 2 (Д-Д-В-НГ)

**Чего НЕТ в заключении:**
- Диаметр спинномозгового канала (в мм по МРТ/КТ)
- Наличие/отсутствие стеноза
- Грубые проводниковые/корешковые расстройства
- Парезы мышц
- Нарушение функции сфинктеров
- Результаты лечения

**Ответ системы:**
```json
{
  "article": 66,
  "subpoint": null,
  "confidence": 0.3,
  "reasoning": "⚠️ НЕДОСТАТОЧНО ДАННЫХ: В Приказе №722 нет прямых критериев для грыж межпозвоночных дисков. Указана грыжа L5-S1 с секвестрацией, но для точной классификации по подпунктам статьи 66 необходимы данные о стенозе спинномозгового канала (диаметр в мм), наличии/отсутствии грубых неврологических нарушений (парезы, нарушение функции сфинктеров), результатах консервативного или оперативного лечения.",
  "data_insufficiency": true,
  "missing_parameters": [
    "Диаметр спинномозгового канала в мм (по МРТ/КТ)",
    "Наличие/отсутствие стеноза",
    "Грубые проводниковые или корешковые расстройства",
    "Парезы мышц нижних конечностей",
    "Нарушение функции тазовых органов (сфинктеров)",
    "Данные о проведенном консервативном/оперативном лечении"
  ],
  "required_examinations": [
    "МРТ поясничного отдела позвоночника с измерением диаметра спинномозгового канала",
    "Консультация невролога с оценкой неврологического статуса",
    "Оценка силы мышц нижних конечностей",
    "Оценка функции тазовых органов"
  ]
}
```

#### ✅ Достаточно данных:

**Заключение врача:**
```
Грыжа межпозвоночного диска L5-S1 с секвестрацией.
По данным МРТ: стеноз позвоночного канала на уровне L5-S1 до 14 мм.
Неврологический статус: корешковый синдром L5, гипестезия по наружной поверхности голени и тыла стопы слева, снижение ахиллова рефлекса слева.
Функция тазовых органов не нарушена. Парезов нет.
Консервативное лечение в течение 3 месяцев - без стойкого эффекта.
```

**Ответ системы:**
```json
{
  "article": 66,
  "subpoint": "2",
  "confidence": 0.85,
  "reasoning": "Соответствует критериям подпункта 2 статьи 66: приобретенный стеноз спинномозгового канала (14 мм при норме >16 мм для поясничного отдела), сопровождающийся клиническими проявлениями - корешковый синдром L5, чувствительные нарушения. Нет грубых проводниковых расстройств и нарушения сфинктеров, что исключает подпункт 1. Категория: Д-Д-В-НГ (для графов I, II, III, IV соответственно).",
  "matched_criteria": "Приобретенный стеноз спинномозгового канала, сопровождающийся клиническими проявлениями (боли, неврологические расстройства)",
  "parameters_matched": {
    "stenosis_diameter_mm": 14,
    "neurological_deficit": "корешковый синдром L5",
    "no_severe_paresis": true,
    "no_sphincter_dysfunction": true
  },
  "data_insufficiency": false
}
```

### 2. Миопия (близорукость)

#### ❌ Недостаточно данных:

**Заключение:**
```
Миопия средней степени обоих глаз
```

**Чего НЕТ:**
- Конкретные значения в диоптриях

**Ответ системы:**
```json
{
  "article": 34,
  "subpoint": null,
  "confidence": 0.4,
  "reasoning": "⚠️ НЕДОСТАТОЧНО ДАННЫХ: Указана миопия средней степени, но в Приказе №722 классификация по статье 34 требует точного указания диоптрий. Без точных значений невозможно определить подпункт.",
  "data_insufficiency": true,
  "missing_parameters": ["Острота зрения в диоптриях для каждого глаза"],
  "required_examinations": ["Визометрия с коррекцией", "Рефрактометрия"]
}
```

#### ✅ Достаточно данных:

**Заключение:**
```
Миопия обоих глаз: OD -4.5 дптр, OS -4.25 дптр
```

**Ответ системы:**
```json
{
  "article": 34,
  "subpoint": "4",
  "confidence": 0.95,
  "reasoning": "Близорукость обоих глаз от 3.0 до 6.0 диоптрий соответствует подпункту 4 статьи 34. Категория Б (годен с незначительными ограничениями).",
  "parameters_matched": {
    "od_diopters": -4.5,
    "os_diopters": -4.25
  },
  "data_insufficiency": false
}
```

### 3. Артериальная гипертензия

#### ❌ Недостаточно данных:

**Заключение:**
```
Артериальная гипертензия
```

**Чего НЕТ:**
- Степень АГ (1, 2, 3)
- Наличие/отсутствие осложнений
- Данные о лечении

#### ✅ Достаточно данных:

**Заключение:**
```
Артериальная гипертензия 2 степени. АД 160/100 мм рт.ст.
Гипертрофия левого желудочка по данным ЭхоКГ.
На фоне регулярной терапии - контроль АД удовлетворительный.
```

## Логика обработки в системе

### Алгоритм определения недостаточности данных:

1. **AI анализирует заключение врача**
2. **Сопоставляет с критериями из Приложения 2 к Приказу №722**
3. **Проверяет наличие всех необходимых параметров:**
   - Количественные показатели (мм, диоптрии, степени)
   - Клинические проявления
   - Результаты обследований
   - Результаты лечения

4. **Если данных недостаточно:**
   ```python
   {
     "confidence": < 0.5,
     "reasoning": "⚠️ НЕДОСТАТОЧНО ДАННЫХ: ...",
     "data_insufficiency": true,
     "missing_parameters": [...],
     "required_examinations": [...]
   }
   ```

5. **Система НЕ ПЫТАЕТСЯ "угадать" или "интерпретировать"**

## UI: Отображение недостаточности данных

Когда `data_insufficiency: true`, интерфейс должен показать:

```
⚠️ НЕДОСТАТОЧНО ДАННЫХ ДЛЯ ТОЧНОЙ КЛАССИФИКАЦИИ

Статья: 66 (Дорсопатии)
Уверенность: 30%

Проблема:
В Приказе №722 нет прямых критериев для грыж межпозвоночных дисков.

Недостающие параметры:
✗ Диаметр спинномозгового канала в мм (по МРТ/КТ)
✗ Наличие/отсутствие стеноза
✗ Грубые проводниковые или корешковые расстройства
✗ Парезы мышц нижних конечностей
✗ Нарушение функции тазовых органов

Необходимые обследования:
→ МРТ поясничного отдела с измерением диаметра канала
→ Консультация невролога
→ Оценка силы мышц нижних конечностей
→ Оценка функции тазовых органов

Рекомендация:
Запросить дополнительные обследования для точной классификации.
```

## Преимущества подхода

### ✅ Честность и прозрачность
- Система не скрывает недостаток информации
- Пользователь видит, какие данные нужны

### ✅ Соответствие закону
- Работа СТРОГО по Приказу №722
- Нет произвольных интерпретаций

### ✅ Медицинская безопасность
- Снижение риска ошибочных решений
- Запрос недостающих обследований

### ✅ Защита от злоупотреблений
- Нельзя "обмануть" систему неполными данными
- Требуется полная медицинская документация

## Статистика по недостаточности данных

Система должна отслеживать:
- Процент случаев с `data_insufficiency: true`
- Наиболее частые недостающие параметры
- Статьи/диагнозы с наибольшей недостаточностью данных

Это поможет:
- Улучшить формы заключений врачей
- Добавить подсказки/чек-листы для врачей
- Выявить проблемные места в Приказе №722

## Версионирование

- **Версия:** 1.0
- **Дата:** 9 декабря 2025
- **Автор:** eMedosmotr AI Team
- **Основание:** Приказ МО РК №722 от 21 декабря 2020 года
