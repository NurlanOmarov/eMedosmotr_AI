-- Тестовые данные призывников для MVP (исправленная версия)
-- 15 кейсов с различными медицинскими профилями
-- ✅ Все названия специальностей приведены к стандарту
-- ✅ Добавлены все обязательные специалисты: Терапевт, Хирург, Офтальмолог, Невролог, Кардиолог

-- Очистка существующих тестовых данных (если есть)
TRUNCATE TABLE ai_analysis_results, specialists_examinations, conscript_drafts, conscripts CASCADE;

-- Призывники
INSERT INTO conscripts (iin, first_name, last_name, middle_name, birth_date, phone, address) VALUES
('991201450789', 'Петр', 'Иванов', 'Сергеевич', '1999-12-01', '+77012345678', 'г. Алматы, ул. Абая 123'),
('000315301234', 'Азамат', 'Нурболат', 'Серікұлы', '2000-03-15', '+77012345679', 'г. Астана, пр. Республики 45'),
('010520302345', 'Алексей', 'Сидоров', 'Александрович', '2001-05-20', '+77012345680', 'г. Шымкент, ул. Байтурсынова 67'),
('020815303456', 'Ерлан', 'Қаиров', 'Нұрланұлы', '2002-08-15', '+77012345681', 'г. Караганда, ул. Бухар-Жырау 89'),
('031012304567', 'Дмитрий', 'Кузнецов', 'Владимирович', '2003-10-12', '+77012345682', 'г. Актобе, пр. Абылхаир хана 12'),
('040225305678', 'Арман', 'Омаров', 'Болатұлы', '2004-02-25', '+77012345683', 'г. Тараз, ул. Толе би 34'),
('050607306789', 'Максим', 'Петров', 'Игоревич', '2005-06-07', '+77012345684', 'г. Павлодар, ул. Ленина 56'),
('991115307890', 'Бауыржан', 'Әбішев', 'Қанатұлы', '1999-11-15', '+77012345685', 'г. Усть-Каменогорск, ул. Гагарина 78'),
('000420308901', 'Андрей', 'Волков', 'Николаевич', '2000-04-20', '+77012345686', 'г. Семей, ул. Пушкина 90'),
('010918309012', 'Dias', 'Жұмабаев', 'Серікұлы', '2001-09-18', '+77012345687', 'г. Кызылорда, ул. Абая 11'),
('021203310123', 'Сергей', 'Морозов', 'Алексеевич', '2002-12-03', '+77012345688', 'г. Атырау, пр. Азаттык 22'),
('030730311234', 'Темірлан', 'Бекбосын', 'Асанұлы', '2003-07-30', '+77012345689', 'г. Костанай, ул. Байтурсынова 33'),
('041105312345', 'Игорь', 'Смирнов', 'Павлович', '2004-11-05', '+77012345690', 'г. Петропавловск, ул. Конституции 44'),
('050322313456', 'Нұрсұлтан', 'Мұратбек', 'Әлиұлы', '2005-03-22', '+77012345691', 'г. Актау, мкр. 15, д. 55'),
('991008314567', 'Владислав', 'Козлов', 'Дмитриевич', '1999-10-08', '+77012345692', 'г. Туркестан, ул. Яссауи 66');

-- Призывные кампании
INSERT INTO conscript_drafts (conscript_id, draft_number, draft_date, graph, status) VALUES
(1, '2025-10-01234', '2025-10-01', 1, 'in_progress'),
(2, '2025-10-01235', '2025-10-01', 1, 'in_progress'),
(3, '2025-10-01236', '2025-10-01', 1, 'in_progress'),
(4, '2025-10-01237', '2025-10-01', 1, 'in_progress'),
(5, '2025-10-01238', '2025-10-01', 1, 'in_progress'),
(6, '2025-10-01239', '2025-10-01', 1, 'in_progress'),
(7, '2025-10-01240', '2025-10-01', 1, 'in_progress'),
(8, '2025-10-01241', '2025-10-01', 1, 'in_progress'),
(9, '2025-10-01242', '2025-10-01', 1, 'in_progress'),
(10, '2025-10-01243', '2025-10-01', 1, 'in_progress'),
(11, '2025-10-01244', '2025-10-01', 1, 'in_progress'),
(12, '2025-10-01245', '2025-10-01', 1, 'in_progress'),
(13, '2025-10-01246', '2025-10-01', 1, 'in_progress'),
(14, '2025-10-01247', '2025-10-01', 1, 'in_progress'),
(15, '2025-10-01248', '2025-10-01', 1, 'in_progress');

-- Заключения врачей
-- ✅ Исправлено: "Окулист" → "Офтальмолог", "Невропатолог" → "Невролог"
-- ✅ Добавлены недостающие обязательные специалисты для всех призывников

-- Призывник 1: Иванов П.С. - грыжа диска (расхождение у хирурга)
INSERT INTO specialists_examinations (conscript_id, draft_id, specialty, diagnosis_text, icd10_code, article, subpoint, category, doctor_name) VALUES
(1, 1, 'Терапевт', 'Легкое течение бронхита', 'J20.9', 52, 'в', 'Б-3', 'Смирнова А.В.'),
(1, 1, 'Хирург', 'Грыжа межпозвоночного диска L5-S1, 7мм, секвестрация', 'M51.1', 66, 'б', 'В', 'Казаков И.П.'),
(1, 1, 'Офтальмолог', 'Острота зрения в норме', NULL, NULL, NULL, 'А', 'Назарбаева К.М.'),
(1, 1, 'Невролог', 'Без патологии', NULL, NULL, NULL, 'А', 'Абишева Р.К.'),
(1, 1, 'Кардиолог', 'Без патологии', NULL, NULL, NULL, 'А', 'Нуркенова А.Б.');

-- Призывник 2: Нурболат А. - полное совпадение, здоров
INSERT INTO specialists_examinations (conscript_id, draft_id, specialty, diagnosis_text, icd10_code, article, subpoint, category, doctor_name) VALUES
(2, 2, 'Терапевт', 'Здоров', NULL, NULL, NULL, 'А', 'Смирнова А.В.'),
(2, 2, 'Хирург', 'Патологии не выявлено', NULL, NULL, NULL, 'А', 'Казаков И.П.'),
(2, 2, 'Офтальмолог', 'Зрение в норме', NULL, NULL, NULL, 'А', 'Назарбаева К.М.'),
(2, 2, 'Невролог', 'Без патологии', NULL, NULL, NULL, 'А', 'Абишева Р.К.'),
(2, 2, 'Кардиолог', 'Без патологии', NULL, NULL, NULL, 'А', 'Нуркенова А.Б.');

-- Призывник 3: Сидоров А.А. - астма, категория Г
INSERT INTO specialists_examinations (conscript_id, draft_id, specialty, diagnosis_text, icd10_code, article, subpoint, category, doctor_name) VALUES
(3, 3, 'Терапевт', 'Бронхиальная астма, среднетяжелое течение', 'J45.0', 52, 'а', 'Г', 'Смирнова А.В.'),
(3, 3, 'Хирург', 'Без патологии', NULL, NULL, NULL, 'А', 'Казаков И.П.'),
(3, 3, 'Офтальмолог', 'Зрение в норме', NULL, NULL, NULL, 'А', 'Назарбаева К.М.'),
(3, 3, 'Невролог', 'Без патологии', NULL, NULL, NULL, 'А', 'Абишева Р.К.'),
(3, 3, 'Кардиолог', 'Без патологии', NULL, NULL, NULL, 'А', 'Нуркенова А.Б.');

-- Призывник 4: Қаиров Е. - плоскостопие 3ст, категория В (расхождение)
INSERT INTO specialists_examinations (conscript_id, draft_id, specialty, diagnosis_text, icd10_code, article, subpoint, category, doctor_name) VALUES
(4, 4, 'Терапевт', 'Здоров', NULL, NULL, NULL, 'А', 'Смирнова А.В.'),
(4, 4, 'Хирург', 'Плоскостопие 3 степени, двустороннее', 'M21.4', 68, 'в', 'Б-3', 'Казаков И.П.'),
(4, 4, 'Офтальмолог', 'Зрение в норме', NULL, NULL, NULL, 'А', 'Назарбаева К.М.'),
(4, 4, 'Невролог', 'Без патологии', NULL, NULL, NULL, 'А', 'Абишева Р.К.'),
(4, 4, 'Кардиолог', 'Без патологии', NULL, NULL, NULL, 'А', 'Нуркенова А.Б.');

-- Призывник 5: Кузнецов Д.В. - множественные диагнозы
INSERT INTO specialists_examinations (conscript_id, draft_id, specialty, diagnosis_text, icd10_code, article, subpoint, category, doctor_name) VALUES
(5, 5, 'Терапевт', 'Хронический гастрит', 'K29.5', 59, 'в', 'Б', 'Смирнова А.В.'),
(5, 5, 'Офтальмолог', 'Миопия средней степени OD -5.0 OS -4.5', 'H52.1', 13, 'б', 'В', 'Назарбаева К.М.'),
(5, 5, 'Дерматолог', 'Псориаз, ограниченная форма', 'L40.0', 62, 'г', 'Д', 'Сарсенова М.А.'),
(5, 5, 'Хирург', 'Без патологии', NULL, NULL, NULL, 'А', 'Казаков И.П.'),
(5, 5, 'Невролог', 'Без патологии', NULL, NULL, NULL, 'А', 'Абишева Р.К.'),
(5, 5, 'Кардиолог', 'Без патологии', NULL, NULL, NULL, 'А', 'Нуркенова А.Б.');

-- Призывник 6: Омаров А. - сколиоз 2ст
INSERT INTO specialists_examinations (conscript_id, draft_id, specialty, diagnosis_text, icd10_code, article, subpoint, category, doctor_name) VALUES
(6, 6, 'Терапевт', 'Здоров', NULL, NULL, NULL, 'А', 'Смирнова А.В.'),
(6, 6, 'Хирург', 'Сколиоз 2 степени', 'M41.1', 66, 'в', 'Б', 'Казаков И.П.'),
(6, 6, 'Офтальмолог', 'Зрение в норме', NULL, NULL, NULL, 'А', 'Назарбаева К.М.'),
(6, 6, 'Невролог', 'Без патологии', NULL, NULL, NULL, 'А', 'Абишева Р.К.'),
(6, 6, 'Кардиолог', 'Без патологии', NULL, NULL, NULL, 'А', 'Нуркенова А.Б.');

-- Призывник 7: Петров М.И. - здоров
INSERT INTO specialists_examinations (conscript_id, draft_id, specialty, diagnosis_text, icd10_code, article, subpoint, category, doctor_name) VALUES
(7, 7, 'Терапевт', 'Здоров', NULL, NULL, NULL, 'А', 'Смирнова А.В.'),
(7, 7, 'Хирург', 'Патологии не выявлено', NULL, NULL, NULL, 'А', 'Казаков И.П.'),
(7, 7, 'Офтальмолог', 'Зрение в норме', NULL, NULL, NULL, 'А', 'Назарбаева К.М.'),
(7, 7, 'Невролог', 'Без патологии', NULL, NULL, NULL, 'А', 'Абишева Р.К.'),
(7, 7, 'Кардиолог', 'Без патологии', NULL, NULL, NULL, 'А', 'Нуркенова А.Б.');

-- Призывник 8: Әбішев Б. - высокая миопия, категория Д
INSERT INTO specialists_examinations (conscript_id, draft_id, specialty, diagnosis_text, icd10_code, article, subpoint, category, doctor_name) VALUES
(8, 8, 'Терапевт', 'Здоров', NULL, NULL, NULL, 'А', 'Смирнова А.В.'),
(8, 8, 'Офтальмолог', 'Миопия высокой степени OD -9.0 OS -8.5', 'H52.1', 13, 'а', 'Д', 'Назарбаева К.М.'),
(8, 8, 'Невролог', 'Без патологии', NULL, NULL, NULL, 'А', 'Абишева Р.К.'),
(8, 8, 'Хирург', 'Без патологии', NULL, NULL, NULL, 'А', 'Казаков И.П.'),
(8, 8, 'Кардиолог', 'Без патологии', NULL, NULL, NULL, 'А', 'Нуркенова А.Б.');

-- Призывник 9: Волков А.Н. - гипертония
INSERT INTO specialists_examinations (conscript_id, draft_id, specialty, diagnosis_text, icd10_code, article, subpoint, category, doctor_name) VALUES
(9, 9, 'Терапевт', 'Гипертоническая болезнь 1 стадии', 'I10', 42, 'г', 'В', 'Смирнова А.В.'),
(9, 9, 'Хирург', 'Без патологии', NULL, NULL, NULL, 'А', 'Казаков И.П.'),
(9, 9, 'Офтальмолог', 'Зрение в норме', NULL, NULL, NULL, 'А', 'Назарбаева К.М.'),
(9, 9, 'Невролог', 'Без патологии', NULL, NULL, NULL, 'А', 'Абишева Р.К.'),
(9, 9, 'Кардиолог', 'Без патологии', NULL, NULL, NULL, 'А', 'Нуркенова А.Б.');

-- Призывник 10: Жұмабаев Д. - здоров
INSERT INTO specialists_examinations (conscript_id, draft_id, specialty, diagnosis_text, icd10_code, article, subpoint, category, doctor_name) VALUES
(10, 10, 'Терапевт', 'Здоров', NULL, NULL, NULL, 'А', 'Смирнова А.В.'),
(10, 10, 'Хирург', 'Без патологии', NULL, NULL, NULL, 'А', 'Казаков И.П.'),
(10, 10, 'ЛОР', 'Без патологии', NULL, NULL, NULL, 'А', 'Кусаинов Т.Б.'),
(10, 10, 'Офтальмолог', 'Зрение в норме', NULL, NULL, NULL, 'А', 'Назарбаева К.М.'),
(10, 10, 'Невролог', 'Без патологии', NULL, NULL, NULL, 'А', 'Абишева Р.К.'),
(10, 10, 'Кардиолог', 'Без патологии', NULL, NULL, NULL, 'А', 'Нуркенова А.Б.');

-- Призывник 11: Морозов С.А. - хр. тонзиллит
INSERT INTO specialists_examinations (conscript_id, draft_id, specialty, diagnosis_text, icd10_code, article, subpoint, category, doctor_name) VALUES
(11, 11, 'Терапевт', 'Здоров', NULL, NULL, NULL, 'А', 'Смирнова А.В.'),
(11, 11, 'ЛОР', 'Хронический тонзиллит, компенсированная форма', 'J35.0', 49, 'в', 'Б', 'Кусаинов Т.Б.'),
(11, 11, 'Офтальмолог', 'Зрение в норме', NULL, NULL, NULL, 'А', 'Назарбаева К.М.'),
(11, 11, 'Хирург', 'Без патологии', NULL, NULL, NULL, 'А', 'Казаков И.П.'),
(11, 11, 'Невролог', 'Без патологии', NULL, NULL, NULL, 'А', 'Абишева Р.К.'),
(11, 11, 'Кардиолог', 'Без патологии', NULL, NULL, NULL, 'А', 'Нуркенова А.Б.');

-- Призывник 12: Бекбосын Т. - варикоцеле 2ст
INSERT INTO specialists_examinations (conscript_id, draft_id, specialty, diagnosis_text, icd10_code, article, subpoint, category, doctor_name) VALUES
(12, 12, 'Терапевт', 'Здоров', NULL, NULL, NULL, 'А', 'Смирнова А.В.'),
(12, 12, 'Хирург', 'Варикоцеле 2 степени слева', 'I86.1', 45, 'в', 'В', 'Казаков И.П.'),
(12, 12, 'Уролог', 'Варикоцеле 2ст, показано наблюдение', 'I86.1', 45, 'в', 'В', 'Садыков Б.М.'),
(12, 12, 'Офтальмолог', 'Зрение в норме', NULL, NULL, NULL, 'А', 'Назарбаева К.М.'),
(12, 12, 'Невролог', 'Без патологии', NULL, NULL, NULL, 'А', 'Абишева Р.К.'),
(12, 12, 'Кардиолог', 'Без патологии', NULL, NULL, NULL, 'А', 'Нуркенова А.Б.');

-- Призывник 13: Смирнов И.П. - незначительная миопия
INSERT INTO specialists_examinations (conscript_id, draft_id, specialty, diagnosis_text, icd10_code, article, subpoint, category, doctor_name) VALUES
(13, 13, 'Терапевт', 'Здоров', NULL, NULL, NULL, 'А', 'Смирнова А.В.'),
(13, 13, 'Офтальмолог', 'Миопия слабой степени OD -2.0 OS -1.5', 'H52.1', 13, 'в', 'Б', 'Назарбаева К.М.'),
(13, 13, 'Хирург', 'Без патологии', NULL, NULL, NULL, 'А', 'Казаков И.П.'),
(13, 13, 'Невролог', 'Без патологии', NULL, NULL, NULL, 'А', 'Абишева Р.К.'),
(13, 13, 'Кардиолог', 'Без патологии', NULL, NULL, NULL, 'А', 'Нуркенова А.Б.');

-- Призывник 14: Мұратбек Н. - здоров, спортсмен
INSERT INTO specialists_examinations (conscript_id, draft_id, specialty, diagnosis_text, icd10_code, article, subpoint, category, doctor_name) VALUES
(14, 14, 'Терапевт', 'Здоров, занимается спортом', NULL, NULL, NULL, 'А', 'Смирнова А.В.'),
(14, 14, 'Хирург', 'Без патологии', NULL, NULL, NULL, 'А', 'Казаков И.П.'),
(14, 14, 'Офтальмолог', 'Зрение отличное', NULL, NULL, NULL, 'А', 'Назарбаева К.М.'),
(14, 14, 'Невролог', 'Без патологии', NULL, NULL, NULL, 'А', 'Абишева Р.К.'),
(14, 14, 'Кардиолог', 'Без патологии', NULL, NULL, NULL, 'А', 'Нуркенова А.Б.');

-- Призывник 15: Козлов В.Д. - аллергический ринит
INSERT INTO specialists_examinations (conscript_id, draft_id, specialty, diagnosis_text, icd10_code, article, subpoint, category, doctor_name) VALUES
(15, 15, 'Терапевт', 'Аллергический ринит, сезонный', 'J30.1', 49, 'г', 'Б-3', 'Смирнова А.В.'),
(15, 15, 'ЛОР', 'Вазомоторный ринит', 'J30.0', 49, 'г', 'Б-3', 'Кусаинов Т.Б.'),
(15, 15, 'Офтальмолог', 'Зрение в норме', NULL, NULL, NULL, 'А', 'Назарбаева К.М.'),
(15, 15, 'Хирург', 'Без патологии', NULL, NULL, NULL, 'А', 'Казаков И.П.'),
(15, 15, 'Невролог', 'Без патологии', NULL, NULL, NULL, 'А', 'Абишева Р.К.'),
(15, 15, 'Кардиолог', 'Без патологии', NULL, NULL, NULL, 'А', 'Нуркенова А.Б.');

-- Добавляем истории из ЭРДБ для некоторых призывников
INSERT INTO erdb_diagnoses_history (conscript_id, icd10_code, diagnosis_text, diagnosis_date, medical_org, specialty) VALUES
(1, 'M51.1', 'Грыжа межпозвоночного диска', '2024-03-15', 'Поликлиника №5', 'Невролог'),
(1, 'M51.1', 'Грыжа МПД L5-S1, обострение', '2024-08-20', 'Городская больница №1', 'Невролог'),
(3, 'J45.0', 'Бронхиальная астма', '2023-11-10', 'Детская поликлиника №3', 'Пульмонолог'),
(5, 'K29.5', 'Хронический гастрит', '2024-01-25', 'Поликлиника №7', 'Гастроэнтеролог'),
(8, 'H52.1', 'Миопия высокой степени', '2020-09-05', 'Офтальмологический центр', 'Офтальмолог');

-- ✅ Проверка завершенности
SELECT
  c.last_name || ' ' || c.first_name as prizyvnik,
  COUNT(CASE WHEN se.specialty = 'Терапевт' THEN 1 END) as Терапевт,
  COUNT(CASE WHEN se.specialty = 'Хирург' THEN 1 END) as Хирург,
  COUNT(CASE WHEN se.specialty = 'Офтальмолог' THEN 1 END) as Офтальмолог,
  COUNT(CASE WHEN se.specialty = 'Невролог' THEN 1 END) as Невролог,
  COUNT(CASE WHEN se.specialty = 'Кардиолог' THEN 1 END) as Кардиолог,
  CASE
    WHEN COUNT(CASE WHEN se.specialty IN ('Терапевт', 'Хирург', 'Офтальмолог', 'Невролог', 'Кардиолог') THEN 1 END) = 5
    THEN '✅ Завершено'
    ELSE '❌ Не завершено'
  END as status
FROM conscripts c
JOIN conscript_drafts cd ON c.id = cd.conscript_id
LEFT JOIN specialists_examinations se ON cd.id = se.draft_id
GROUP BY c.id, c.last_name, c.first_name
ORDER BY c.last_name;

-- ✅ Тестовые данные загружены!
SELECT 'Загружено призывников: ' || COUNT(*) FROM conscripts;
SELECT 'Загружено заключений: ' || COUNT(*) FROM specialists_examinations;
SELECT 'Загружено записей ЭРДБ: ' || COUNT(*) FROM erdb_diagnoses_history;
