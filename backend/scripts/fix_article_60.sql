-- ========================================
-- ИСПРАВЛЕНИЕ СТАТЬИ 60 - Геморрой
-- ========================================
--
-- ПРОБЛЕМА: В БД шаблонные описания вместо конкретных стадий геморроя
-- РЕШЕНИЕ: Обновить описания согласно Приложению 2
--

-- Текущее состояние
SELECT 'ТЕКУЩЕЕ СОСТОЯНИЕ:' as status;
SELECT subpoint, description, graph_1, graph_2, graph_3, graph_4
FROM point_criteria
WHERE article = 60
ORDER BY subpoint::int;

-- Удаляем все старые критерии
DELETE FROM point_criteria WHERE article = 60;

-- Вставляем правильные критерии согласно Приложению 2

-- Подпункт 1: IV стадия (Е, Е, Д, НГ)
INSERT INTO point_criteria (article, subpoint, description, graph_1, graph_2, graph_3, graph_4)
VALUES (
    60,
    '1',
    'IV стадия хронического геморроя, характеризующаяся постоянным выпадением геморроидальных узлов вместе со слизистой оболочкой прямой кишки и невозможностью вправления в анальный канал с кровотечением или без',
    'Е', 'Е', 'Д', 'НГ'
);

-- Подпункт 2: III стадия и II стадия с частыми осложнениями (Д, Д, В-ИНД, НГ)
INSERT INTO point_criteria (article, subpoint, description, graph_1, graph_2, graph_3, graph_4)
VALUES
(
    60,
    '2',
    'III стадия хронического геморроя, характеризующаяся периодическим выпадением узлов с необходимостью их ручного вправления с кровотечениями или без кровотечения',
    'Д', 'Д', 'В-ИНД', 'НГ'
),
(
    60,
    '2',
    'II стадия хронического геморроя с частыми осложнениями (кровотечения, тромбоз или выпадения геморроидальных узлов, по поводу которых освидетельствуемый три и более раз в год лечился в стационаре)',
    'Д', 'Д', 'В-ИНД', 'НГ'
);

-- Подпункт 3: I-II стадия без частых осложнений (Д, Д, Б, ИНД)
INSERT INTO point_criteria (article, subpoint, description, graph_1, graph_2, graph_3, graph_4)
VALUES
(
    60,
    '3',
    'II стадия хронического геморроя без частых осложнений, характеризующаяся выпадением узлов с самопроизвольным вправлением в анальный канал с кровотечением или без кровотечения',
    'Д', 'Д', 'Б', 'ИНД'
),
(
    60,
    '3',
    'I стадия хронического геморроя, характеризующаяся выделением крови из заднего прохода без болевого синдрома и выпадения геморроидальных узлов',
    'Д', 'Д', 'Б', 'ИНД'
);

-- Проверяем результат
SELECT 'НОВОЕ СОСТОЯНИЕ:' as result;
SELECT subpoint, description, graph_1, graph_2, graph_3, graph_4
FROM point_criteria
WHERE article = 60
ORDER BY subpoint::int, description;

-- Подсчет
SELECT 'СТАТИСТИКА:' as stats;
SELECT
    subpoint,
    COUNT(*) as criteria_count
FROM point_criteria
WHERE article = 60
GROUP BY subpoint
ORDER BY subpoint::int;
